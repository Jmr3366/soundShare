<!DOCTYPE html>
<html lang="en-au">
<head>
<title>soundShare</title>
<style type="text/css">
body { font-family: Verdana, Arial, Helvetica, sans-serif; position: relative; color: #222222; font-size: 1.0em; }
<script type="text/javascript" src="jsonpath.js"></script>
<script type="text/javascript" src="json2.js"></script>
</style>
</head>
<body>
<div id="response" style="border: 1px solid blue; min-height:50px; min-width:50px;">placeholder</div>
<h3>Shared Sound Links</h3>
<div id="content"></div>
<a href="audio/foley/"><h4>Foley</h4></a>
<a href="audio/loops/"><h4>Loops</h4></a>
<a href="audio/music/"><h4>Music</h4></a>
<a href="audio/UI"/><h4>User Interface</h4></a>

<script >
  /* JSONPath 0.8.0 - XPath for JSON
 *
 * Copyright (c) 2007 Stefan Goessner (goessner.net)
 * Licensed under the MIT (MIT-LICENSE.txt) licence.
 */
var jsonPath = function(obj, expr, arg) {
   var P = {
      resultType: arg && arg.resultType || "VALUE",
      result: [],
      normalize: function(expr) {
         var subx = [];
         return expr.replace(/[\['](\??\(.*?\))[\]']/g, function($0,$1){return "[#"+(subx.push($1)-1)+"]";})
                    .replace(/'?\.'?|\['?/g, ";")
                    .replace(/;;;|;;/g, ";..;")
                    .replace(/;$|'?\]|'$/g, "")
                    .replace(/#([0-9]+)/g, function($0,$1){return subx[$1];});
      },
      asPath: function(path) {
         var x = path.split(";"), p = "$";
         for (var i=1,n=x.length; i<n; i++)
            p += /^[0-9*]+$/.test(x[i]) ? ("["+x[i]+"]") : ("['"+x[i]+"']");
         return p;
      },
      store: function(p, v) {
         if (p) P.result[P.result.length] = P.resultType == "PATH" ? P.asPath(p) : v;
         return !!p;
      },
      trace: function(expr, val, path) {
         if (expr) {
            var x = expr.split(";"), loc = x.shift();
            x = x.join(";");
            if (val && val.hasOwnProperty(loc))
               P.trace(x, val[loc], path + ";" + loc);
            else if (loc === "*")
               P.walk(loc, x, val, path, function(m,l,x,v,p) { P.trace(m+";"+x,v,p); });
            else if (loc === "..") {
               P.trace(x, val, path);
               P.walk(loc, x, val, path, function(m,l,x,v,p) { typeof v[m] === "object" && P.trace("..;"+x,v[m],p+";"+m); });
            }
            else if (/,/.test(loc)) { // [name1,name2,...]
               for (var s=loc.split(/'?,'?/),i=0,n=s.length; i<n; i++)
                  P.trace(s[i]+";"+x, val, path);
            }
            else if (/^\(.*?\)$/.test(loc)) // [(expr)]
               P.trace(P.eval(loc, val, path.substr(path.lastIndexOf(";")+1))+";"+x, val, path);
            else if (/^\?\(.*?\)$/.test(loc)) // [?(expr)]
               P.walk(loc, x, val, path, function(m,l,x,v,p) { if (P.eval(l.replace(/^\?\((.*?)\)$/,"$1"),v[m],m)) P.trace(m+";"+x,v,p); });
            else if (/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(loc)) // [start:end:step]  phyton slice syntax
               P.slice(loc, x, val, path);
         }
         else
            P.store(path, val);
      },
      walk: function(loc, expr, val, path, f) {
         if (val instanceof Array) {
            for (var i=0,n=val.length; i<n; i++)
               if (i in val)
                  f(i,loc,expr,val,path);
         }
         else if (typeof val === "object") {
            for (var m in val)
               if (val.hasOwnProperty(m))
                  f(m,loc,expr,val,path);
         }
      },
      slice: function(loc, expr, val, path) {
         if (val instanceof Array) {
            var len=val.length, start=0, end=len, step=1;
            loc.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g, function($0,$1,$2,$3){start=parseInt($1||start);end=parseInt($2||end);step=parseInt($3||step);});
            start = (start < 0) ? Math.max(0,start+len) : Math.min(len,start);
            end   = (end < 0)   ? Math.max(0,end+len)   : Math.min(len,end);
            for (var i=start; i<end; i+=step)
               P.trace(i+";"+expr, val, path);
         }
      },
      eval: function(x, _v, _vname) {
         try { return $ && _v && eval(x.replace(/@/g, "_v")); }
         catch(e) { throw new SyntaxError("jsonPath: " + e.message + ": " + x.replace(/@/g, "_v").replace(/\^/g, "_a")); }
      }
   };

   var $ = obj;
   if (expr && obj && (P.resultType == "VALUE" || P.resultType == "PATH")) {
      P.trace(P.normalize(expr).replace(/^\$;/,""), obj, "$");
      return P.result.length ? P.result : false;
   }
} 

  </script>

<script type="module">
  import { request } from "https://cdn.pika.dev/@octokit/request";
  const basePath = "/repos/bubblobill/soundShare/contents/"; 
  import data from '/treeList.json'  assert { type: 'json' };
  /*
  myAsyncMethod("audio");

  async function myAsyncMethod(path) { 
  //client.Git.Tree.Get
    const result = await request('GET /repos/bubblobill/soundShare/git/trees/c1f6d668952386076e846cea4300977364ef1cb1?recursive=1', {
  owner: 'OWNER',
  repo: 'REPO',
  tree_sha: 'TREE_SHA',
  headers: {
    'X-GitHub-Api-Version': '2022-11-28'
  }
  })

    
    
    //" + basePath + path);
    update(result.data);
  }
  
  function update(json){
    //let txt = jsonPath(json, "$.name[*]").toJSONString();
    document.getElementById("response").innerText = JSON.stringify(json);
    
    for(let i = 0;i < json.length; i++){
      let entry = json[i];
      let a = document.createElement("a");
      let el = document.createElement("button");
      let txt = document.createTextNode(entry.name);
      el.appendChild(txt);
      a.appendChild(el)
      if(entry.type === "file"){
        a.href = entry.html_url;
      }
      document.getElementById("content").appendChild(el);
      a.dataset.path = entry.path;
      a.dataset.type = entry.type;
      a.dataset.download_url = entry.download_url;
      a.dataset.size = entry.size;
      el.addEventListener("click", function(e){
        console.log(e.target.dataset.path);
        console.log(e.target.dataset.type);
        console.log(e.target.dataset.download_url );
        console.log(e.target.dataset.size);
        console.log(e.target.tagName);
      });
      if(entry.type === "dir"){ update(entry.path);}
    }
    
    
  }
  */
  window.addEventListener("load", function(){
    buildFileMap(jsn);
  });
  function buildFileMap(json){
    let txt = JSON.parse(json).tree;
    document.getElementById("response").innerText = txt;
    JSONPath(txt.tree);
  }
</script>
</body>
</html>
