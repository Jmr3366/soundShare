<!DOCTYPE html>
<html>
<head>
<title>soundShare</title>
<style>
body { font-family: Verdana, Arial, Helvetica, sans-serif; position: relative; color: #222222; font-size: 1.0em; }
</style>
<link type="text/css" href="css/treejs.min.css" />
<script type="text/javascript" src="js/tree.min.js"></script>
<script type="text/javascript" src="js/jsonpath.js"></script>
<script type="text/javascript" src="js/json2.js"></script>
</head>
<body>
<div id="response" style="border: 1px solid blue; min-height:50px; min-width:50px;">placeholder</div>
<h3>Shared Sound Links</h3>
<div id="content"></div>
<a href="audio/foley/"><h4>Foley</h4></a>
<a href="audio/loops/"><h4>Loops</h4></a>
<a href="audio/music/"><h4>Music</h4></a>
<a href="audio/UI/"><h4>User Interface</h4></a>
<div id="tree"></div>
<div id="template">
<input type="checkbox" value="https://bubblobill.github.io/soundShare/audio/UI/LawOrder_dundun_.mp3">
  <audio controls>
    <source src="https://bubblobill.github.io/soundShare/audio/UI/LawOrder_dundun_.mp3" type="audio/mpeg">
  </audio>
</div>
  <script>
    //import listing from '/treeList.json'  assert { type: 'json' };
  var dirListing;
  var tree = {};
  function fetchJSONData() {
    fetch("https://raw.githubusercontent.com/bubblobill/soundShare/main/treeList.json")
        .then((res) => {
            if (!res.ok) {
                throw new Error
                    (`HTTP error! Status: ${res.status}`);
            }
            return res.json();
        })
        .then((data) =>
             buildFileMap(data)) // console.log(data))
        .catch((error) =>
               console.error("Unable to fetch data:", error));
  }


  window.addEventListener("load", function(){
    dirListing = fetchJSONData();
  });
  function buildFileMap(json){
    let paths = jsonPath(json, "$..path");
    let dirs = Object.values(jsonPath(json, "$..[?(@.type==`tree`)].path"));
    document.getElementById("response").innerText = JSON.stringify(dirs);
    let dirArr = filesToTreeNodes(paths, dirs);
    var root = new TreeNode("Audio"); // Create the root-node
    var tree_ = new TreeView(root, document.getElementById("tree"), {show_root:false});

    loopNodes(dirArr, root);
    function loopNodes(arrArr, node){
      for(let i = 0; i < arrArr.length; i++){
        let ob = arrArr[i];
        let n1 = new TreeNode(ob.fileName)
        n1.userObject = ob;
        node.addChild(n1)
        let path = new TreePath(root, n1);
        console.log(path.toString());
        if(ob.isDirectory){
          loopNodes(arrArr[i].children, n1);
        }
      }
    }
    tree_.reload();
    //let nodes = tree_.getPath
   // console.log(nodes);
//        let clone = template.cloneNode(true);
  //      clone.getElementsByTagName("source")[0].src = "https://bubblobill.github.io/soundShare/audio/" + item.innerText;
    //    item.before(clone);


    //console.log(nodes.length);
  }


  function filesToTreeNodes(arr, dirs) {
    var tree = {}
    function addnode(obj) {
      var splitpath = obj.replace(/^\/|\/$/g, "").split('/');
      var ptr = tree;
      for (let i = 0; i < splitpath.length; i++) {
        let node = {
          fileName: splitpath[i],
          path: obj,
          isDirectory: false
        };
        if (dirs.includes(obj)) {
          node.isDirectory = true
        }
        ptr[splitpath[i]] = ptr[splitpath[i]] || node;
        ptr[splitpath[i]].children = ptr[splitpath[i]].children || {};
        ptr = ptr[splitpath[i]].children;
      }
    }
    function objectToArr(node) {
      Object.keys(node || {}).map((k) => {
        if (node[k].children) {
          objectToArr(node[k])
        }
      })
      if (node.children) {
        node.children = Object.values(node.children)
        node.children.forEach(objectToArr)
      }
    }
    arr.map(addnode);
    objectToArr(tree)
    return Object.values(tree)
  }


  var div = document.getElementById('myList');




  function addToClipboard() {
    // Get the text field
    var copyText = document.getElementById("myInput");
    // Select the text field
    copyText.select();
    copyText.setSelectionRange(0, 99999); // For mobile devices
     // Copy the text inside the text field
    navigator.clipboard.writeText(copyText.value);
    // Alert the copied text
    alert("Copied the text: " + copyText.value);
  }
  </script>
</body>
</html>
